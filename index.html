<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dubai Traffic Incidents ‚Äì Part 2</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'IBM Plex Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      line-height: 1.6;
      color: #1a202c;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      overflow-x: hidden;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* Hero Section with Animation */
    .hero {
      text-align: center;
      padding: 80px 20px 60px;
      color: white;
      animation: fadeInDown 0.8s ease-out;
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .hero h1 {
      font-size: 3.5rem;
      font-weight: 800;
      margin-bottom: 20px;
      text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
      letter-spacing: -1px;
    }

    .hero .subtitle {
      font-size: 1.35rem;
      opacity: 0.95;
      max-width: 700px;
      margin: 0 auto 10px;
      font-weight: 300;
    }

    .hero .course-info {
      font-size: 1rem;
      opacity: 0.85;
      font-weight: 500;
      margin-top: 15px;
      padding: 12px 24px;
      background: rgba(255,255,255,0.15);
      display: inline-block;
      border-radius: 30px;
      backdrop-filter: blur(10px);
    }

    /* Stats Bar */
    .stats-bar {
      background: rgba(255,255,255,0.12);
      backdrop-filter: blur(10px);
      padding: 30px 20px;
      text-align: center;
      color: white;
      animation: fadeIn 1s ease-out 0.3s both;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 30px;
      max-width: 900px;
      margin: 0 auto;
    }

    .stat-item {
      animation: scaleIn 0.6s ease-out both;
    }

    .stat-item:nth-child(1) { animation-delay: 0.4s; }
    .stat-item:nth-child(2) { animation-delay: 0.5s; }
    .stat-item:nth-child(3) { animation-delay: 0.6s; }

    @keyframes scaleIn {
      from {
        opacity: 0;
        transform: scale(0.8);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .stat-number {
      font-size: 2.5rem;
      font-weight: 700;
      display: block;
      margin-bottom: 8px;
    }

    .stat-label {
      font-size: 1rem;
      opacity: 0.9;
      font-weight: 400;
    }

    /* Content Section */
    .content {
      background: #f7fafc;
      border-radius: 30px 30px 0 0;
      margin-top: 50px;
      padding: 70px 0;
      box-shadow: 0 -10px 50px rgba(0,0,0,0.15);
      position: relative;
    }

    /* Section Header */
    .section-header {
      text-align: center;
      margin-bottom: 60px;
      animation: fadeInUp 0.8s ease-out;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .section-header h2 {
      font-size: 2.5rem;
      font-weight: 700;
      color: #1a202c;
      margin-bottom: 12px;
    }

    .section-header p {
      font-size: 1.15rem;
      color: #4a5568;
      max-width: 700px;
      margin: 0 auto;
    }

    /* Visualization Cards */
    .viz-section {
      margin-bottom: 70px;
      animation: fadeInUp 0.8s ease-out both;
    }

    .viz-section:nth-child(2) { animation-delay: 0.2s; }
    .viz-section:nth-child(3) { animation-delay: 0.4s; }
    .viz-section:nth-child(4) { animation-delay: 0.6s; }

    .viz-card {
      background: #ffffff;
      border-radius: 20px;
      padding: 50px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      border: 2px solid #e2e8f0;
      transition: all 0.4s ease;
      position: relative;
      overflow: hidden;
    }

    .viz-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    }

    .viz-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.12);
      border-color: #cbd5e0;
    }

    .viz-header {
      margin-bottom: 35px;
    }

    .viz-title-row {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .viz-number {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 50px;
      height: 50px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 12px;
      font-size: 1.5rem;
      font-weight: 700;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .viz-header h3 {
      font-size: 2rem;
      color: #1a202c;
      font-weight: 700;
      flex: 1;
    }

    .task-badge {
      padding: 6px 16px;
      background: #edf2f7;
      color: #4a5568;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
    }

    /* Interactive Buttons */
    .interactive-buttons {
      display: flex;
      gap: 12px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .info-btn {
      padding: 10px 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .info-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .info-btn:active {
      transform: translateY(0);
    }

    .info-btn.secondary {
      background: #48bb78;
    }

    .info-btn.secondary:hover {
      box-shadow: 0 6px 20px rgba(72, 187, 120, 0.4);
    }

    .info-btn.tertiary {
      background: #ed8936;
    }

    .info-btn.tertiary:hover {
      box-shadow: 0 6px 20px rgba(237, 137, 54, 0.4);
    }

    /* Info Panels */
    .info-panel {
      background: linear-gradient(135deg, #f0f4ff 0%, #faf5ff 100%);
      border: 2px solid #667eea;
      border-radius: 12px;
      padding: 25px;
      margin-top: 20px;
      display: none;
      animation: slideDown 0.4s ease-out;
    }

    .info-panel.active {
      display: block;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .info-panel h4 {
      font-size: 1.3rem;
      color: #1a202c;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .info-panel p {
      color: #4a5568;
      font-size: 1.05rem;
      line-height: 1.8;
      margin-bottom: 12px;
    }

    .info-panel ul {
      list-style: none;
      padding-left: 0;
      margin-top: 15px;
    }

    .info-panel li {
      color: #2d3748;
      font-size: 1rem;
      margin-bottom: 10px;
      padding-left: 30px;
      position: relative;
      line-height: 1.6;
    }

    .info-panel li::before {
      content: 'üí°';
      position: absolute;
      left: 0;
      font-size: 1.2rem;
    }

    .insight-panel {
      background: linear-gradient(135deg, #e6fffa 0%, #f0fff4 100%);
      border: 2px solid #48bb78;
    }

    .howto-panel {
      background: linear-gradient(135deg, #fff5e6 0%, #fef5e7 100%);
      border: 2px solid #ed8936;
    }

    .viz-description {
      color: #4a5568;
      font-size: 1.1rem;
      line-height: 1.8;
      margin-bottom: 10px;
    }

    .viz-requirements {
      background: #f7fafc;
      padding: 20px;
      border-radius: 12px;
      margin-top: 16px;
      border-left: 4px solid #667eea;
    }

    .viz-requirements h4 {
      font-size: 1rem;
      color: #2d3748;
      margin-bottom: 10px;
      font-weight: 600;
    }

    .viz-requirements ul {
      list-style: none;
      padding-left: 0;
    }

    .viz-requirements li {
      color: #4a5568;
      font-size: 0.95rem;
      margin-bottom: 6px;
      padding-left: 20px;
      position: relative;
    }

    .viz-requirements li::before {
      content: '‚úì';
      position: absolute;
      left: 0;
      color: #48bb78;
      font-weight: 700;
    }

    .chart-container {
      background: #ffffff;
      border-radius: 12px;
      padding: 30px;
      margin-top: 30px;
      box-shadow: inset 0 2px 8px rgba(0,0,0,0.03);
      border: 1px solid #e2e8f0;
    }

    .chart {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 400px;
    }

    /* Key Insights Box */
    .key-insights {
      background: linear-gradient(135deg, #fff9e6 0%, #fffbf0 100%);
      border-left: 5px solid #f6ad55;
      padding: 20px 25px;
      margin-top: 20px;
      border-radius: 8px;
    }

    .key-insights h4 {
      font-size: 1.1rem;
      color: #744210;
      margin-bottom: 12px;
      font-weight: 700;
    }

    .key-insights p {
      color: #975a16;
      font-size: 1rem;
      line-height: 1.7;
      margin-bottom: 8px;
    }

    .key-insights strong {
      color: #744210;
    }

    /* Footer */
    .footer {
      text-align: center;
      padding: 50px 20px;
      color: white;
      font-size: 1rem;
    }

    .footer p {
      opacity: 0.95;
      margin-bottom: 8px;
    }

    .footer .copyright {
      opacity: 0.75;
      font-size: 0.9rem;
    }

    /* Loading Animation */
    .loading {
      display: inline-block;
      width: 50px;
      height: 50px;
      border: 5px solid #e2e8f0;
      border-top-color: #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .hero h1 {
        font-size: 2.2rem;
      }

      .hero .subtitle {
        font-size: 1.1rem;
      }

      .viz-card {
        padding: 30px 20px;
      }

      .viz-header h3 {
        font-size: 1.5rem;
      }

      .viz-title-row {
        flex-wrap: wrap;
      }

      .stats-grid {
        grid-template-columns: 1fr;
        gap: 20px;
      }

      .interactive-buttons {
        flex-direction: column;
      }

      .info-btn {
        width: 100%;
        justify-content: center;
      }
    }
  </style>
</head>
<body>

  <!-- Hero Section -->
  <div class="hero">
    <div class="container">
      <h1>üöó Dubai Traffic Incidents Analysis</h1>
      <p class="subtitle">A visual exploration of how traffic accidents happen, when they occur, how often, and where they‚Äôre most common.</p>
      <div class="course-info">Introduction to Data Visualization ‚Ä¢ Part 2: Vega-Lite</div>
    </div>
  </div>

  <!-- Stats Bar -->
  <div class="stats-bar">
    <div class="stats-grid">
      <div class="stat-item">
        <span class="stat-number">3</span>
        <span class="stat-label">Visualizations</span>
      </div>
      <div class="stat-item">
        <span class="stat-number">Vega-Lite</span>
        <span class="stat-label">Technology Used</span>
      </div>
      <div class="stat-item">
        <span class="stat-number">Dubai</span>
        <span class="stat-label">Dataset Source</span>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="content">
    <div class="container">

      <!-- Section Header -->
      <div class="section-header">
        <h2>Interactive Visualizations</h2>
        <p>Traffic incident visiualization data with three distinct visualization approaches, each demonstrating unique patterns and insights</p>
      </div>

      <!-- Visualization 1 -->
      <div class="viz-section">
        <div class="viz-card">
          <div class="viz-header">
            <div class="viz-title-row">
              <span class="viz-number">1</span>
              <h3>Accidents by Day of Week</h3>
              <span class="task-badge">Task 1 ‚Ä¢ 30%</span>
            </div>
            <p class="viz-description">
              This bar chart shows how traffic accidents in Dubai are spread across the days of the week. 
               You can instantly see which days have more incidents just by looking at the height of the bars.  
              The colors help separate each day so it‚Äôs easy to notice pattern like which day tends to be the busiest or the safest on the roads.
            </p>

            <div class="interactive-buttons">
              <button class="info-btn" onclick="togglePanel('explanation1')">
                <span>üìö</span> How to Read This Chart
              </button>
              <button class="info-btn secondary" onclick="togglePanel('insights1')">
                <span>üîç</span> Key Insights
              </button>
              <button class="info-btn tertiary" onclick="togglePanel('technical1')">
                <span>‚öôÔ∏è</span> Technical Details
              </button>
            </div>

            <div id="explanation1" class="info-panel howto-panel">
              <h4>üìñ How to Read This Visualization</h4>
              <p><strong>What you're looking at:</strong> A bar chart where each bar represents one day of the week.</p>
              <ul>
                <li><strong>X-Axis (Horizontal):</strong> Shows the days of the week from Monday to Sunday</li>
                <li><strong>Y-Axis (Vertical):</strong> Shows the total number of accidents that occurred on that day</li>
                <li><strong>Bar Heights:</strong> Taller bars = more accidents on that day</li>
                <li><strong>Colors:</strong> Each day has a unique color to help you distinguish them quickly</li>
                <li><strong>Hover over bars:</strong> Get exact accident counts for each day</li>
              </ul>
            </div>

            <div id="insights1" class="info-panel insight-panel">
              <h4>üí° What This Data Tells Us</h4>
              <p>Looking at this chart, you can discover interesting patterns about when accidents happen:</p>
              <ul>
                <li><strong>Weekday vs Weekend:</strong> Compare accident rates between working days and weekends</li>
                <li><strong>Peak Day:</strong> Identify which day has the highest accident rate</li>
                <li><strong>Safest Day:</strong> Find which day tends to have fewer accidents</li>
                <li><strong>Traffic Patterns:</strong> Higher bars might indicate days with heavier traffic or more commuters</li>
                <li><strong>Planning Insight:</strong> This helps city planners know when to increase traffic enforcement</li>
              </ul>
            </div>

            <div id="technical1" class="info-panel">
              <h4>‚öôÔ∏è Technical Implementation</h4>
              <ul>
                <li><strong>Mark Type:</strong> Bar chart for categorical comparison</li>
                <li><strong>Data Processing:</strong> Parsed date/time field using '%d/%m/%Y %H:%M:%S' format</li>
                <li><strong>Time Unit:</strong> Extracted day of week using Vega-Lite's timeUnit transform</li>
                <li><strong>Sorting:</strong> Days ordered Monday through Sunday for logical flow</li>
                <li><strong>Aggregation:</strong> Count of accidents grouped by day</li>
                <li><strong>Encoding:</strong> Color scale distinguishes each day uniquely</li>
              </ul>
            </div>

            
          </div>
          <div class="chart-container">
            <div id="task1" class="chart"><div class="loading"></div></div>
          </div>
        </div>
      </div>

      <!-- Visualization 2 -->
      <div class="viz-section">
        <div class="viz-card">
          <div class="viz-header">
            <div class="viz-title-row">
              <span class="viz-number">2</span>
              <h3>Accidents by Hour, Colored by Weekday</h3>
              <span class="task-badge">Task 2 ‚Ä¢ 30%</span>
            </div>
            <p class="viz-description">
              This line chart tracks how often accidents happen during each hour of the day, with a different color line for every day of the week.
              You can spot rush hour spikes, quiet early mornings, and the differences between weekdays and weekends.
              It‚Äôs a simple way to see when Dubai‚Äôs roads tend to be busiest or safest throughout the day.
            </p>

            <div class="interactive-buttons">
              <button class="info-btn" onclick="togglePanel('explanation2')">
                <span>üìö</span> How to Read This Chart
              </button>
              <button class="info-btn secondary" onclick="togglePanel('insights2')">
                <span>üîç</span> Key Insights
              </button>
              <button class="info-btn tertiary" onclick="togglePanel('technical2')">
                <span>‚öôÔ∏è</span> Technical Details
              </button>
            </div>

            <div id="explanation2" class="info-panel howto-panel">
              <h4>üìñ How to Read This Visualization</h4>
              <p><strong>What you're looking at:</strong> Multiple line charts overlaid on the same graph, one for each day of the week.</p>
              <ul>
                <li><strong>X-Axis (Horizontal):</strong> Shows all 24 hours of the day (0 = midnight, 12 = noon, 23 = 11 PM)</li>
                <li><strong>Y-Axis (Vertical):</strong> Shows the number of accidents that occurred at that hour</li>
                <li><strong>Each Line:</strong> Represents one day of the week (see legend on the right)</li>
                <li><strong>Line Height:</strong> Higher points = more accidents at that specific hour</li>
                <li><strong>Peaks and Valleys:</strong> Show when accidents are most/least frequent during the day</li>
                <li><strong>Hover over points:</strong> See exact hour, day, and accident count</li>
              </ul>
            </div>

            <div id="insights2" class="info-panel insight-panel">
              <h4>üí° What This Data Tells Us</h4>
              <p>This chart reveals fascinating patterns about accident timing throughout the day:</p>
              <ul>
                <li><strong>Morning Rush Hour:</strong> Look for peaks around 7-9 AM when people commute to work</li>
                <li><strong>Evening Rush Hour:</strong> Often shows higher accidents around 5-7 PM</li>
                <li><strong>Lunch Time:</strong> Check if there's a spike around noon</li>
                <li><strong>Late Night:</strong> Typically fewer accidents but possibly more severe ones</li>
                <li><strong>Weekend Patterns:</strong> Compare weekend lines (Fri/Sat/Sun) vs weekday lines - different patterns?</li>
                <li><strong>Safest Hours:</strong> Early morning hours (3-6 AM) usually show lowest accident rates</li>
              </ul>
            </div>

            <div id="technical2" class="info-panel">
              <h4>‚öôÔ∏è Technical Implementation</h4>
              <ul>
                <li><strong>Mark Type:</strong> Line chart with point markers for precise values</li>
                <li><strong>Interpolation:</strong> Monotone curve smoothing for natural flow</li>
                <li><strong>Multi-series:</strong> Separate line for each day of week using color encoding</li>
                <li><strong>Time Unit:</strong> Hours extracted from timestamp (0-23)</li>
                <li><strong>Styling:</strong> Stroke width 2px, opacity 0.9 for clarity without overwhelming</li>
                <li><strong>Color Scheme:</strong> Tableau10 palette for optimal distinction between 7 days</li>
              </ul>
            </div>

            
          </div>
          <div class="chart-container">
            <div id="task2" class="chart"><div class="loading"></div></div>
          </div>
        </div>
      </div>

      <!-- Visualization 3 -->
      <div class="viz-section">
        <div class="viz-card">
          <div class="viz-header">
            <div class="viz-title-row">
              <span class="viz-number">3</span>
              <h3>Accident Density Across Dubai</h3>
              <span class="task-badge">Task 3 ‚Ä¢ 40%</span>
            </div>
            <p class="viz-description">
              This graduated symbol visualization map highlights where accidents happen most often around Dubai.
              Each circle shows a cluster of incidents the bigger and brighter it is, the more accidents occurred there. 
              It‚Äôs an easy way to spot hotspots and understand which parts of the city see the most traffic problems or need extra safety measures.
            </p>

            <div class="interactive-buttons">
              <button class="info-btn" onclick="togglePanel('explanation3')">
                <span>üìö</span> How to Read This Map
              </button>
              <button class="info-btn secondary" onclick="togglePanel('insights3')">
                <span>üîç</span> Key Insights
              </button>
              <button class="info-btn tertiary" onclick="togglePanel('technical3')">
                <span>‚öôÔ∏è</span> Technical Details
              </button>
            </div>

            <div id="explanation3" class="info-panel howto-panel">
              <h4>üìñ How to Read This Visualization</h4>
              <p><strong>What you're looking at:</strong> A geographic map of Dubai with circles showing where accidents occur.</p>
              <ul>
                <li><strong>Map Background:</strong> Shows Dubai's geographic boundary in light gray</li>
                <li><strong>Circle Size:</strong> Bigger circles = more accidents in that location</li>
                <li><strong>Circle Color:</strong> Darker/brighter colors = higher accident density (see legend)</li>
                <li><strong>Color Scale:</strong> Uses "inferno" scheme - darker red/yellow means more accidents</li>
                <li><strong>Opacity:</strong> Circles are semi-transparent (20%) so you can see overlapping hotspots</li>
                <li><strong>Hover over circles:</strong> See exact number of accidents and coordinates</li>
              </ul>
            </div>

            <div id="insights3" class="info-panel insight-panel">
              <h4>üí° What This Data Tells Us</h4>
              <p>This map reveals critical information about where accidents happen in Dubai:</p>
              <ul>
                <li><strong>Hotspot Identification:</strong> Large, bright circles show the most dangerous areas</li>
                <li><strong>Major Roads:</strong> Patterns often form along main highways and arterial roads</li>
                <li><strong>Urban vs Suburban:</strong> Compare accident density between city center and outskirts</li>
                <li><strong>Cluster Patterns:</strong> Multiple overlapping circles indicate consistent problem areas</li>
                <li><strong>Safe Zones:</strong> Areas with no circles have few or no reported accidents</li>
                <li><strong>Planning Value:</strong> Helps authorities decide where to add traffic lights, speed cameras, or road improvements</li>
              </ul>
            </div>

            <div id="technical3" class="info-panel">
              <h4>‚öôÔ∏è Technical Implementation</h4>
              <ul>
                <li><strong>Projection:</strong> Mercator projection centered on Dubai (55.27¬∞E, 25.20¬∞N)</li>
                <li><strong>Data Filtering:</strong> Applied filter "acci_y > 23" to remove noise/invalid coordinates</li>
                <li><strong>Spatial Binning:</strong> Grouped nearby accidents using 0.008-degree grid bins</li>
                <li><strong>Aggregation:</strong> Counted accidents per bin to calculate density</li>
                <li><strong>Mark Type:</strong> Graduated symbols using circles with variable size and color</li>
                <li><strong>Encoding:</strong> Longitude and latitude channels for geographic positioning</li>
                <li><strong>Dual Encoding:</strong> Both size (30-1600 range) and color (inferno scheme) represent density</li>
                <li><strong>Layering:</strong> Base layer (Dubai boundary) + data layer (accident circles)</li>
              </ul>
            </div>

            
          </div>
          <div class="chart-container">
            <div id="task3" class="chart"><div class="loading"></div></div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <div class="container">
      <p>Introduction to Data Visualization</p>
      <p>Assignment Part 2: Traffic Incident Analysis Using Vega-Lite</p>
      <p>Data Source: Dubai Emirate Traffic Incidents Dataset</p>
      <p>Done by Saif, Mohammed, Mohammed, Ali, Abdulaziz</p>
    </div>
  </div>

<script>
const DATA_URL = "https://raw.githubusercontent.com/sheriefAbdallah/CS318/refs/heads/main/Traffic_Incidents.csv";

// Toggle info panels
function togglePanel(panelId) {
  const panel = document.getElementById(panelId);
  const allPanels = document.querySelectorAll('.info-panel');
  
  // Close all other panels in the same section
  const section = panel.closest('.viz-card');
  section.querySelectorAll('.info-panel').forEach(p => {
    if (p.id !== panelId) {
      p.classList.remove('active');
    }
  });
  
  // Toggle the clicked panel
  panel.classList.toggle('active');
}

/* -------- Task 1: Bar chart by weekday -------- */
const spec1 = {
  $schema: "https://vega.github.io/schema/vega-lite/v5.json",
  description: "Accident distribution by day of the week",
  width: 900,
  height: 320,
  data: {
    url: DATA_URL,
    format: { type: "csv", parse: { acci_time: "date:'%d/%m/%Y %H:%M:%S'" } }
  },
  mark: "bar",
  encoding: {
    x: {
      timeUnit: "day",
      field: "acci_time",
      type: "ordinal",
      title: "Day of Week",
      sort: ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],
      axis: { labelAngle: 0 }
    },
    y: { aggregate: "count", title: "Number of Accidents" },
    color: {
      timeUnit: "day",
      field: "acci_time",
      type: "nominal",
      title: "Day",
      scale: { domain: ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"] }
    },
    tooltip: [
      { aggregate: "count", title: "Accidents" },
      { timeUnit: "day", field: "acci_time", type: "ordinal", title: "Day" }
    ]
  }
};

/* -------- Task 2: Line chart by hour, colored by weekday -------- */
const spec2 = {
  $schema: "https://vega.github.io/schema/vega-lite/v5.json",
  description: "Accident distribution by hour of day, colored by weekday",
  width: 1000,
  height: 340,
  data: {
    url: DATA_URL,
    format: { type: "csv", parse: { acci_time: "date:'%d/%m/%Y %H:%M:%S'" } }
  },
  mark: { type: "line", point: true, interpolate: "monotone", strokeWidth: 2, opacity: 0.9 },
  encoding: {
    x: {
      timeUnit: "hours",
      field: "acci_time",
      type: "ordinal",
      title: "Hour of Day",
      sort: [...Array(24).keys()],
      axis: {
        labelAngle: 0,
        tickBand: "center",
        values: [...Array(24).keys()],
        labelExpr: "datum.label"
      }
    },
    y: { aggregate: "count", title: "Number of Accidents" },
    color: {
      timeUnit: "day",
      field: "acci_time",
      type: "nominal",
      title: "Day of Week",
      scale: { scheme: "tableau10", domain: ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"] },
      legend: { orient: "right" }
    },
    tooltip: [
      { aggregate: "count", title: "Accidents" },
      { timeUnit: "day", field: "acci_time", type: "ordinal", title: "Day" },
      { timeUnit: "hours", field: "acci_time", type: "ordinal", title: "Hour" }
    ]
  }
};

/* -------- Task 3: Graduated-symbol density over Dubai boundary -------- */
const spec3 = {
  $schema: "https://vega.github.io/schema/vega-lite/v5.json",
  description: "Dubai traffic accidents, graduated symbols over Dubai boundary",
  title: { text: "Accident Density Across Dubai", fontSize: 22, fontWeight: "bold", anchor: "start", offset: 16 },
  width: 900,
  height: 600,
  projection: { type: "mercator", center: [55.27, 25.20], scale: 46000 },
  layer: [
    {
      data: {
        url: "https://raw.githubusercontent.com/saifsmm/part2/refs/heads/main/dubai_boundary.geojson",
        format: { type: "geojson" }
      },
      mark: { type: "geoshape", fill: "#f4f4f4", stroke: "#c0c0c0" }
    },
    {
      data: { url: DATA_URL, format: { type: "csv" } },
      transform: [
        { filter: "toNumber(datum.acci_y) > 23" },
        { calculate: "toNumber(datum.acci_y)", as: "lon" },
        { calculate: "toNumber(datum.acci_x)", as: "lat" },
        { bin: { step: 0.008 }, field: "lon", as: ["lon_b","lon_e"] },
        { bin: { step: 0.008 }, field: "lat", as: ["lat_b","lat_e"] },
        { calculate: "(datum.lon_b + datum.lon_e)/2", as: "lon_mid" },
        { calculate: "(datum.lat_b + datum.lat_e)/2", as: "lat_mid" },
        { aggregate: [{ op: "count", as: "cnt" }], groupby: ["lon_mid","lat_mid"] }
      ],
      mark: { type: "circle", opacity: 0.2 },
      encoding: {
        longitude: { field: "lon_mid", type: "quantitative", title: "Longitude" },
        latitude:  { field: "lat_mid", type: "quantitative", title: "Latitude" },
        size: {
          field: "cnt", type: "quantitative", title: "Number of Accidents",
          scale: { range: [30, 1600] }, legend: { titleFontSize: 14, labelFontSize: 12 }
        },
        color: {
          field: "cnt", type: "quantitative", title: "Accident Density",
          scale: { scheme: "inferno" }, legend: { titleFontSize: 14, labelFontSize: 12 }
        },
        tooltip: [
          { field: "cnt", title: "Number of Accidents" },
          { field: "lon_mid", title: "Longitude" },
          { field: "lat_mid", title: "Latitude" }
        ]
      }
    }
  ],
  config: {
    axis:   { labelFontSize: 12, titleFontSize: 14 },
    legend: { orient: "right", titleFontSize: 14, labelFontSize: 12 }
  }
};

vegaEmbed("#task1", spec1, { actions: false });
vegaEmbed("#task2", spec2, { actions: false });
vegaEmbed("#task3", spec3, { actions: false });
</script>
</body>
</html>
